---
output: html_document
---
\begin{center}
Project 1
\end{center}
### Summary
Using the mtcars data set in R, a data set of a collection of cars, this analysis explores the relationship between a set of variables and miles per gallon (MPG) (outcome). We seek to determine whether automatic or manual is better for MPG, and to quantify the differences in MPG between the two.  

### Part 1: Is an automatic or manual transmission better for MPG?
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(car)

```

First, let's examine the data and relevel the factor variables.
```{r}
data(mtcars)

mtcars$cyl<-relevel(as.factor(mtcars$cyl), ref='8')
mtcars$vs<-relevel(as.factor(mtcars$vs), ref='0')
mtcars$am<-relevel(as.factor(mtcars$am), ref='0',labels=c('Automatic','Manual'))
mtcars$gear<-relevel(as.factor(mtcars$gear), ref='3')
mtcars$carb<-relevel(as.factor(mtcars$carb), ref='2')
```

Now, model mpg and transmission using a 2-variable linear model.
```{r}
lm1 <- lm(mpg~am,data=mtcars)
summary(lm1)$coef
summary(lm1)$adj.r.squared
```
From the data, we know 'am', aka transmission, is a binary variable with automatic equal to 0 and manual equal to 1.
Based on the output, we can see that the average mpg for automatic is 17.147, whereas for manual it is 24.392

Now, let's fit a regression model including all variables.
```{r}
lm2 <- lm(mpg~.,mtcars)
summary(lm2)$adj.r.squared
```
From the output, we can see the adjusted R-squared indicates that some variables are included that are not important. In addition, all variables in this model are insignificant.

```{r, include=FALSE}
vif(lm2)
```
The conclusion above is also shown by VIF. Now we'll use the `step`function to determine which variables are significant. 

```{r, include=FALSE}
lm3 <- step(lm2,direction="both")
```
```{r}
lm3$coefficients
summary(lm3)$adj.r.squared
```
The output has demonstrated that `cyl4`,`cyl6`,`hp`,`wt`, and `am1` are significant variables. In addition, this model has a higher adjusted R-squared than the previous.

```{r,eval=FALSE}
anova(lm1,lm2,lm3)
```

The `anova` output verifies that the 3rd model, `lm3`, is the most adequate.


After performing diagnostic plots of the residuals, **Figure 2** shows that the residuals appear to have mean of 0, but not constant variance.   
**Figure 3** indicates that the residuals do not completely follow normal distribution. Therefore, the model is not perfect.   


However, from the different models tested, the data indicates that manual transmission may be better for MPG rather than automatic.

***

### Part 2: Quantify the MPG difference between automatic and manual transmissions 

First, we look back at the `lm1` model to see the slope of the `am` variable, which quantifies the difference between automatic and manual transmissions.
```{r}
summary(lm1)$coef[2]
```
We can see that without any other variables, manual transmission cars get about 7.245 more miles per gallon than automatic transmission cars.
```{r}
summary(lm3)$coef[6]
```
With all other factors held constant, manual transmission cars get about 1.809 more miles per gallon than automatic transmission cars.  
***
\newpage

## Appendix 

```{r fig1,fig.width=5, fig.height=3,fig.align = "center"}
boxplot(mpg~am, data=mtcars, main ='Figure 1 \nFuel Efficiency',ylab='MPG',
        xlab="transmission",names=c("Automatic","Manual"),notch=FALSE, col=(c("blue","red")))
```



```{r fig2,fig.width=5, fig.height=3,fig.align = "center"}
plot(lm3,which=1,main="Figure 2")
plot(lm3,which=2,main="Figure 3")
```










